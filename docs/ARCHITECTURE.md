# Script Architecture

This document describes the Script ecosystem architecture, the philosophy behind each layer, and the transition path to full self-hosting.

---

## Philosophy

**Script Core is like C without libc** â€” a minimal, self-contained language that can run without any external dependencies. Everything else is optional layers that add convenience.

| Layer | Required? | Analogy |
|-------|-----------|---------|
| Script Core | âœ… Always | C language + basic allocator |
| Rolls | âŒ Optional | libc, POSIX, system libraries |
| NPM (via .nroll) | âŒ Optional | Third-party C libraries |
| Unroll | âŒ Optional | make, cargo, package manager |

---

## Ecosystem Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                           USER APPLICATION                                  â”‚
â”‚                           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚                           myapp.script                                      â”‚
â”‚                                                                             â”‚
â”‚   import { serve } from "@rolls/http";                                      â”‚
â”‚   import { connect } from "@rolls/db";                                      â”‚
â”‚   import lodash from "lodash";  // npm converted to .nroll                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
                    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               â”‚   â”‚                                         â”‚
â”‚       SCRIPT CORE             â”‚   â”‚              ROLLS                      â”‚
â”‚       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”‚   â”‚              â”€â”€â”€â”€â”€                      â”‚
â”‚                               â”‚   â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  Official System Libraries              â”‚
â”‚  â”‚  Compiler (scriptc)     â”‚  â”‚   â”‚                                         â”‚
â”‚  â”‚  â”œâ”€â”€ Lexer              â”‚  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â”œâ”€â”€ Parser             â”‚  â”‚   â”‚  â”‚ @rolls/async   Event loop,      â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Type Checker       â”‚  â”‚   â”‚  â”‚                io_uring         â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ IR Generator       â”‚  â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  â”œâ”€â”€ Optimizer          â”‚  â”‚   â”‚  â”‚ @rolls/http    HTTP/1.1, HTTP/2 â”‚    â”‚
â”‚  â”‚  â””â”€â”€ Native Codegen     â”‚  â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â”‚ @rolls/tls     TLS via rustls   â”‚    â”‚
â”‚                               â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”‚ @rolls/db      Database drivers â”‚    â”‚
â”‚  â”‚  Runtime                â”‚  â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  â”œâ”€â”€ NaN-boxed Values   â”‚  â”‚   â”‚  â”‚ @rolls/fs      File system      â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Heap Allocator     â”‚  â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  â”œâ”€â”€ GC (future)        â”‚  â”‚   â”‚  â”‚ @rolls/json    JSON parse/str   â”‚    â”‚
â”‚  â”‚  â””â”€â”€ FFI Stubs          â”‚  â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â”‚ @rolls/crypto  Hashing, etc.    â”‚    â”‚
â”‚                               â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚                                         â”‚
â”‚  â”‚  Primitives             â”‚  â”‚   â”‚  âš¡ Not required for core execution     â”‚
â”‚  â”‚  â”œâ”€â”€ number, string     â”‚  â”‚   â”‚  âœ… Batteries included for real apps   â”‚
â”‚  â”‚  â”œâ”€â”€ boolean, null      â”‚  â”‚   â”‚  ğŸ“¦ Statically linked into binary      â”‚
â”‚  â”‚  â”œâ”€â”€ object, array      â”‚  â”‚   â”‚                                         â”‚
â”‚  â”‚  â”œâ”€â”€ function           â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚  â””â”€â”€ console.log        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               â”‚               â”‚                             â”‚
â”‚  âœ… RUNNABLE WITHOUT ROLLS    â”‚               â”‚      NPM ECOSYSTEM          â”‚
â”‚  âœ… RUNNABLE WITHOUT UNROLL   â”‚               â”‚      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚  âœ… SINGLE BINARY OUTPUT      â”‚               â”‚                             â”‚
â”‚                               â”‚               â”‚  Converted to .nroll format â”‚
â”‚  Like C without libc:         â”‚               â”‚  â”œâ”€â”€ lodash.nroll           â”‚
â”‚  - Can allocate memory        â”‚               â”‚  â”œâ”€â”€ uuid.nroll             â”‚
â”‚  - Can do math                â”‚               â”‚  â”œâ”€â”€ zod.nroll              â”‚
â”‚  - Can print output           â”‚               â”‚  â””â”€â”€ ...                    â”‚
â”‚  - Can call functions         â”‚               â”‚                             â”‚
â”‚  - Cannot do HTTP (no Rolls)  â”‚               â”‚  ğŸ“¦ Precompiled, no runtime â”‚
â”‚  - Cannot read files (no Rolls)â”‚              â”‚  ğŸ“¦ No node_modules folder  â”‚
â”‚                               â”‚               â”‚  ğŸ“¦ Statically linked       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                             â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                              UNROLL                                         â”‚
â”‚                              â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚                                                                             â”‚
â”‚  Build System & Package Manager                                             â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  unroll.toml (Project Manifest)                                     â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚    â”‚
â”‚  â”‚  [package]                                                          â”‚    â”‚
â”‚  â”‚  name = "myapp"                                                     â”‚    â”‚
â”‚  â”‚  version = "1.0.0"                                                  â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  [dependencies]                                                     â”‚    â”‚
â”‚  â”‚  "@rolls/http" = "^1.0"                                             â”‚    â”‚
â”‚  â”‚  "@rolls/db" = "^2.0"                                               â”‚    â”‚
â”‚  â”‚  "lodash" = { npm = "^4.17", features = ["collection"] }            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ unroll build  â”‚  â”‚ unroll run    â”‚  â”‚ unroll add    â”‚  â”‚ unroll fmt  â”‚   â”‚
â”‚  â”‚               â”‚  â”‚               â”‚  â”‚               â”‚  â”‚             â”‚   â”‚
â”‚  â”‚ Compile all   â”‚  â”‚ Build + Run   â”‚  â”‚ Add dependencyâ”‚  â”‚ Format code â”‚   â”‚
â”‚  â”‚ Link static   â”‚  â”‚ Dev mode      â”‚  â”‚ Update lock   â”‚  â”‚             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  unroll.lock (Lockfile)                                             â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚    â”‚
â”‚  â”‚  Deterministic, reproducible builds                                 â”‚    â”‚
â”‚  â”‚  SHA256 verification of all dependencies                            â”‚    â”‚
â”‚  â”‚  Exact versions pinned                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                         FINAL APPLICATION BINARY                            â”‚
â”‚                         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚   ./myapp                                     Single executable     â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚   â”‚ User Code   â”‚ â”‚ Script Core â”‚ â”‚   Rolls     â”‚ â”‚ NPM (.nroll)â”‚   â”‚    â”‚
â”‚  â”‚   â”‚             â”‚ â”‚  Runtime    â”‚ â”‚  Libraries  â”‚ â”‚  Libraries  â”‚   â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚   âœ… No runtime installation required                               â”‚    â”‚
â”‚  â”‚   âœ… No node_modules                                                â”‚    â”‚
â”‚  â”‚   âœ… No dynamic linking (optional)                                  â”‚    â”‚
â”‚  â”‚   âœ… Deploy anywhere: copy single file                              â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## What Each Layer Provides

### Script Core (Always Available)

```javascript
// âœ… These work without Rolls or Unroll

// Variables and types
let x = 42;
let name = "hello";
let obj = { a: 1, b: 2 };
let arr = [1, 2, 3];

// Functions
function add(a, b) {
    return a + b;
}

// Classes
class Point {
    constructor(x, y) {
        this.x = x;
        this.y = y;
    }
}

// Control flow
if (x > 0) { /* ... */ }
for (let i = 0; i < 10; i++) { /* ... */ }
while (condition) { /* ... */ }

// Console output
console.log("Hello, World!");

// Memory allocation (internal)
let bigArray = new Array(1000000);
```

### Rolls (Optional, Recommended)

```javascript
// âŒ These require Rolls

import { serve } from "@rolls/http";
import { readFile } from "@rolls/fs";
import { connect } from "@rolls/db";
import { hash } from "@rolls/crypto";

// HTTP Server
serve({ port: 3000 }, (req) => {
    return new Response("Hello!");
});

// File System
let content = await readFile("config.json");

// Database
let db = await connect("postgres://...");
```

### NPM via .nroll (Optional)

```javascript
// NPM packages converted to .nroll format
import _ from "lodash";          // lodash.nroll
import { v4 as uuid } from "uuid"; // uuid.nroll
import { z } from "zod";          // zod.nroll

let id = uuid();
let sorted = _.sortBy(items, 'name');
```

---

## Compilation Flow

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Source Files      â”‚
                    â”‚   *.script          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SCRIPT CORE COMPILER                              â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Lexer  â”‚â”€â”€â–¶â”‚ Parser  â”‚â”€â”€â–¶â”‚  Type   â”‚â”€â”€â–¶â”‚   IR    â”‚â”€â”€â–¶â”‚   Native    â”‚   â”‚
â”‚   â”‚         â”‚   â”‚   AST   â”‚   â”‚  Check  â”‚   â”‚  + Opt  â”‚   â”‚   Codegen   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Object Files   â”‚
          â”‚  *.o            â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚  + Rolls (if imported)
                   â”‚  + NPM .nroll (if imported)
                   â”‚  + Runtime stubs
                   â”‚
                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚     Linker      â”‚
          â”‚  (LLD / system) â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Executable     â”‚
          â”‚  ./myapp        â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Transition Path: Rust â†’ Self-Hosted

This diagram shows the migration from the current Rust-based compiler to a fully self-hosted Script compiler.

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                           COMPILER EVOLUTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PHASE 1: RUST FOUNDATION (Current)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                     â”‚
    â”‚   src/compiler/ (Rust)              Production compiler             â”‚
    â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                              â”‚
    â”‚                                                                     â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
    â”‚   â”‚   SWC   â”‚â”€â”€â–¶â”‚Bytecode â”‚â”€â”€â–¶â”‚  SSA IR â”‚â”€â”€â–¶â”‚ LLVM / Craneliftâ”‚     â”‚
    â”‚   â”‚ Parser  â”‚   â”‚  Gen    â”‚   â”‚  + Opts â”‚   â”‚    Backend      â”‚     â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
    â”‚                                                      â”‚              â”‚
    â”‚                                                      â–¼              â”‚
    â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
    â”‚                                              â”‚ Native Binary â”‚      â”‚
    â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
    â”‚                                                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                     â”‚
    â”‚   bootstrap/*.tscl                  Reference implementation        â”‚
    â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                  â”‚
    â”‚                                                                     â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
    â”‚   â”‚  Lexer  â”‚â”€â”€â–¶â”‚ Parser  â”‚â”€â”€â–¶â”‚   IR    â”‚â”€â”€â–¶â”‚    Bytecode     â”‚     â”‚
    â”‚   â”‚ (.tscl) â”‚   â”‚ (.tscl) â”‚   â”‚ (.tscl) â”‚   â”‚     Output      â”‚     â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
    â”‚                                                      â”‚              â”‚
    â”‚                                                      â–¼              â”‚
    â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
    â”‚                                              â”‚   Rust VM     â”‚      â”‚
    â”‚                                              â”‚  (executes)   â”‚      â”‚
    â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
    â”‚                                                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


PHASE 2: FEATURE PARITY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                     â”‚
    â”‚   compiler/*.tscl                   Modular, production-ready       â”‚
    â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                   â”‚
    â”‚                                                                     â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
    â”‚   â”‚  Lexer  â”‚â”€â”€â–¶â”‚ Parser  â”‚â”€â”€â–¶â”‚  Type   â”‚â”€â”€â–¶â”‚   IR    â”‚             â”‚
    â”‚   â”‚         â”‚   â”‚         â”‚   â”‚  Check  â”‚   â”‚ + Opts  â”‚             â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜             â”‚
    â”‚                                                  â”‚                  â”‚
    â”‚                 NEW IN PHASE 2:                  â”‚                  â”‚
    â”‚                 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                 â”‚                  â”‚
    â”‚                 âœ… Type inference                â”‚                  â”‚
    â”‚                 âœ… Optimizations (DCE, const fold)                  â”‚
    â”‚                 âœ… Borrow checker                â–¼                  â”‚
    â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
    â”‚                                          â”‚  Bytecode   â”‚            â”‚
    â”‚                                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
    â”‚                                                 â”‚                   â”‚
    â”‚                                                 â–¼                   â”‚
    â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
    â”‚                                          â”‚  Rust VM    â”‚            â”‚
    â”‚                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
    â”‚                                                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


PHASE 3: NATIVE CODEGEN
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                     â”‚
    â”‚   compiler/*.tscl (scriptc)         Full native compiler            â”‚
    â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                         â”‚
    â”‚                                                                     â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
    â”‚   â”‚  Lexer  â”‚â”€â”€â–¶â”‚ Parser  â”‚â”€â”€â–¶â”‚  Type   â”‚â”€â”€â–¶â”‚   IR    â”‚             â”‚
    â”‚   â”‚         â”‚   â”‚         â”‚   â”‚  Check  â”‚   â”‚ + Opts  â”‚             â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜             â”‚
    â”‚                                                  â”‚                  â”‚
    â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚                                    â”‚                           â”‚    â”‚
    â”‚                                    â–¼                           â–¼    â”‚
    â”‚                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
    â”‚                             â”‚   x86-64    â”‚             â”‚  ARM64   â”‚â”‚
    â”‚                             â”‚   Backend   â”‚             â”‚  Backend â”‚â”‚
    â”‚                             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜â”‚
    â”‚                                    â”‚                         â”‚      â”‚
    â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
    â”‚                                                â”‚                    â”‚
    â”‚                 NEW IN PHASE 3:                â–¼                    â”‚
    â”‚                 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
    â”‚                 âœ… x86-64 codegen       â”‚   Native    â”‚             â”‚
    â”‚                 âœ… ARM64 codegen        â”‚   Binary    â”‚             â”‚
    â”‚                 âœ… ELF/Mach-O writer    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
    â”‚                 âœ… Register allocator                               â”‚
    â”‚                 âŒ No Rust needed!                                  â”‚
    â”‚                                                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


PHASE 4: BOOTSTRAP COMPLETE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                     â”‚
    â”‚   BOOTSTRAP VERIFICATION                                            â”‚
    â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                            â”‚
    â”‚                                                                     â”‚
    â”‚                                                                     â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
    â”‚   â”‚                   â”‚                                             â”‚
    â”‚   â”‚  tsclâ‚€ = Rust     â”‚  Original Rust compiler                     â”‚
    â”‚   â”‚  compiler         â”‚                                             â”‚
    â”‚   â”‚                   â”‚                                             â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
    â”‚             â”‚                                                       â”‚
    â”‚             â”‚ compiles compiler/*.tscl                              â”‚
    â”‚             â–¼                                                       â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
    â”‚   â”‚                   â”‚                                             â”‚
    â”‚   â”‚  tsclâ‚ = scriptc  â”‚  First native scriptc                       â”‚
    â”‚   â”‚  (built by Rust)  â”‚                                             â”‚
    â”‚   â”‚                   â”‚                                             â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
    â”‚             â”‚                                                       â”‚
    â”‚             â”‚ compiles compiler/*.tscl                              â”‚
    â”‚             â–¼                                                       â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
    â”‚   â”‚                   â”‚                                             â”‚
    â”‚   â”‚  tsclâ‚‚ = scriptc  â”‚  Self-compiled scriptc                      â”‚
    â”‚   â”‚  (built by tsclâ‚) â”‚                                             â”‚
    â”‚   â”‚                   â”‚                                             â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
    â”‚             â”‚                                                       â”‚
    â”‚             â”‚ compiles compiler/*.tscl                              â”‚
    â”‚             â–¼                                                       â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
    â”‚   â”‚                   â”‚                                             â”‚
    â”‚   â”‚  tsclâ‚ƒ = scriptc  â”‚  Should be identical to tsclâ‚‚               â”‚
    â”‚   â”‚  (built by tsclâ‚‚) â”‚                                             â”‚
    â”‚   â”‚                   â”‚                                             â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
    â”‚                                                                     â”‚
    â”‚                                                                     â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚                                                             â”‚   â”‚
    â”‚   â”‚   VERIFICATION:  sha256(tsclâ‚‚) == sha256(tsclâ‚ƒ)             â”‚   â”‚
    â”‚   â”‚                                                             â”‚   â”‚
    â”‚   â”‚   If hashes match â†’ Deterministic, reproducible compiler    â”‚   â”‚
    â”‚   â”‚   If hashes differ â†’ Bug in codegen, must fix               â”‚   â”‚
    â”‚   â”‚                                                             â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                     â”‚
    â”‚                                                                     â”‚
    â”‚   FINAL STATE:                                                      â”‚
    â”‚   â•â•â•â•â•â•â•â•â•â•â•â•                                                      â”‚
    â”‚                                                                     â”‚
    â”‚   âœ… scriptc compiles itself                                        â”‚
    â”‚   âœ… No Rust compiler needed for development                        â”‚
    â”‚   âœ… Deterministic builds verified                                  â”‚
    â”‚   âœ… src/compiler/ (Rust) kept for reference/testing only           â”‚
    â”‚                                                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              TIMELINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Phase 1          Phase 2          Phase 3          Phase 4
    â•â•â•â•â•â•â•â•         â•â•â•â•â•â•â•â•         â•â•â•â•â•â•â•â•         â•â•â•â•â•â•â•â•

    [Rust+Bootstrap] [Feature Parity] [Native Codegen] [Self-Hosting]
         â”‚                â”‚                â”‚                â”‚
         â”‚   ~2,000       â”‚   ~5,000       â”‚    ~500        â”‚
         â”‚   lines        â”‚   lines        â”‚    lines       â”‚
         â”‚                â”‚                â”‚                â”‚
    â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶

    NOW              +2 months        +4 months        +5 months
                     (estimate)       (estimate)       (estimate)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Repository Structure (Final State)

After Phase 4 completion:

```
script/
â”œâ”€â”€ compiler/                     # THE compiler (scriptc) - MAIN
â”‚   â”œâ”€â”€ main.tscl                 # Entry point
â”‚   â”œâ”€â”€ lexer/                    # Tokenization
â”‚   â”œâ”€â”€ parser/                   # AST generation
â”‚   â”œâ”€â”€ ast/                      # AST types
â”‚   â”œâ”€â”€ passes/                   # Compiler passes
â”‚   â”‚   â”œâ”€â”€ typecheck.tscl        # Type inference
â”‚   â”‚   â”œâ”€â”€ opt.tscl              # Optimizations
â”‚   â”‚   â””â”€â”€ borrow_ck.tscl        # Ownership checking
â”‚   â”œâ”€â”€ ir/                       # SSA IR
â”‚   â”œâ”€â”€ backend/                  # Native codegen
â”‚   â”‚   â”œâ”€â”€ x86_64/               # x86-64 backend
â”‚   â”‚   â”œâ”€â”€ arm64/                # ARM64 backend
â”‚   â”‚   â””â”€â”€ object/               # ELF/Mach-O writers
â”‚   â”œâ”€â”€ codegen/                  # Bytecode gen (for VM)
â”‚   â””â”€â”€ stdlib/                   # Built-in declarations
â”‚
â”œâ”€â”€ src/                          # Rust support code
â”‚   â”œâ”€â”€ runtime/                  # KEEP: ABI, heap, stubs
â”‚   â”‚   â”œâ”€â”€ abi.rs                # NaN-boxed values
â”‚   â”‚   â”œâ”€â”€ heap.rs               # Memory allocation
â”‚   â”‚   â””â”€â”€ stubs.rs              # FFI bridge
â”‚   â””â”€â”€ vm/                       # KEEP: For debugging
â”‚
â”œâ”€â”€ bootstrap/                    # ARCHIVE: Reference only
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ ARCHITECTURE.md           # This file
    â”œâ”€â”€ SELF_HOSTING.md           # Detailed roadmap
    â””â”€â”€ future/
        â”œâ”€â”€ rolls-design.md       # Rolls architecture
        â””â”€â”€ unroll-design.md      # Unroll architecture
```

---

## Key Principles

### 1. Minimal Core
Script Core contains only what's necessary to run code:
- Compiler
- Basic types
- Memory allocation
- Console output

### 2. Optional Batteries
Rolls provides system functionality but is never required:
- HTTP, TLS, Database
- File system, Crypto
- All statically linked

### 3. No Runtime Dependencies
Final binaries have no external dependencies:
- No node_modules
- No dynamic linking (optional)
- No runtime installation

### 4. Reproducible Builds
Everything is deterministic:
- Lockfiles pin exact versions
- SHA256 verification
- Bit-for-bit reproducible with `--dist`

### 5. Progressive Enhancement
Use only what you need:
```
Script Core only     â†’ Minimal binary, ~100KB
+ Rolls              â†’ Full-featured, ~1-5MB
+ NPM libraries      â†’ Ecosystem access, varies
```

---

## Comparison with Other Ecosystems

| Aspect | Script | Node.js | Go | Rust |
|--------|--------|---------|-----|------|
| Core without stdlib | âœ… Yes | âŒ No | âŒ No | âœ… Yes (#![no_std]) |
| Static linking | âœ… Default | âŒ No | âœ… Default | âœ… Default |
| Single binary | âœ… Yes | âŒ No | âœ… Yes | âœ… Yes |
| Package manager | Unroll | npm | go mod | Cargo |
| Self-hosted compiler | ğŸš§ WIP | âŒ No (C++) | âœ… Yes | âœ… Yes |
